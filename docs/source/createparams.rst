Сoздание параметров
===================

Все пользовательские параметры описываются в файле ``parameters.json``.

.. note:: Для описание параметров можно пользоваться любым редактором с подсветкой синтаксиса JSON

Файл должен состоять из `объектов JSON <https://www.json.org/json-ru.html>`_ ``metadata`` и ``ports``, массива ``style_parameters``:

.. code-block::
    :linenos:

    {
        "metadata" : {..},
        "style_parameters" : [..],
        "ports" : {..}
    }

Метаданные
----------

В объекте ``metadata`` описывается общая информация о шаблоне категории оборудования (она не отображается в стиле оборудования Renga).

.. code-block::
    :linenos:

    {
        "metadata" : {
            "name" : "Название оборудования",
            "description" : "Примечание",
            "version" : "1.0",
            "author" : "Иванов Иван Иванович"
        },
        ..
    }

Параметры стиля
---------------

Массив ``style_parameters`` - это упорядоченная коллекция групп параметров, которые будут представлены в окне стиля оборудования. Каждая группа параметров — это объект JSON со своими атрибутами. В массиве ``params`` перечисляются параметры, входящие в эту группу.

.. code-block::
    :linenos:

    {
        ..
        "style_parameters" : [
            {
                "name" : "general",
                "text" : "Общие",
                "params" : [..]
            },
            {
                "name" : "dimensions",
                "text" : "Габаритные размеры",
                "params" : [..]
            },
            ..
        ],
        ..
    }

.. admonition:: Соглашение об описании параметров

    Для унификации отображения параметров в окне стиля оборудования принято группу "Общие" делать первой в списке, второй - группу "Габаритные размеры", а затем указывать группы "Порты" или "Точки подключения".

Пример:

.. image:: _static/Group_params.png
    :align: center

Для любого параметра обязательным является атрибут ``name``. Он является ключом для получения значения этого параметра в скриптах. См. следующий раздел :doc:`Назначение параметров <../assignparams>`

Типы данных
-----------

Параметры можно создавать с различными типами данных. В зависимости от используемого типа данных они по-разному отображаются во вкладке "Параметры" стиля оборудования.

Style
"""""
Используется для указания материала оборудования. Задается с помощью следующих атрибутов:

* ``name`` — название параметра,
* ``text`` — отображаемое название параметра в окне стиля Renga,
* ``type`` — тип данных,
* ``style_type_id`` — указывает на уникальный идентификатор системного типа Renga — Материал. См. `Справку по API Renga <https://help.rengabim.com/api/group___style_type_ids.html>`_.

.. admonition:: Соглашение об описании параметров

    Параметр "Материал" указывается в группе "Общие"

.. code-block::
    :caption: Пример. Описание параметра ``material``
    :linenos:

    {
        "name" : "material",
        "text" : "Материал",
        "type" : "style",
        "style_type_id" : "0abcb18f-0aaf-4509-bf89-5c5fad9d5d8b"
    }

Данный параметр отображается в виде раскрывающегося списка (Combobox) для выбора пользователем нужного материала.

.. image:: _static/material_param.png
    :align: center

List
""""

Указывается при задании возможных вариантов исполнения оборудования.

Для задания параметра с типом данных List используются следующие атрибуты:

* ``name`` — название параметра,
* ``text`` — отображаемое название параметра в окне стиля Renga,
* ``type`` — тип данных,
* ``default`` — значение по-умолчанию,
* ``items`` — список вариантов.

.. code-block::
    :caption: Пример. Описание параметра ``body_shape``
    :linenos:

    {
        "name" : "body_shape",
        "text" : "Форма корпуса",
        "type" : "list",
        "default" : "volute",
        "items" : [
            {
                "key" : "rectangle",
                "text" : "Прямоугольник"            
            },
            {
                "key" : "circle",
                "text" : "Круг"            
            },
            {
                "key" : "volute",
                "text" : "Спираль"            
            }
        ]
    }

Данный параметр отображается в виде раскрывающегося списка (Combobox) для выбора пользователем нужного значения.

.. image:: _static/list_param.png
    :align: center

Enumeration
"""""""""""

Параметры с типом данных Enumeration используются для указания:

- Вида соединения точек подключения (для трубопроводного оборудования :ref:`connector_type <pipe_type>`, для вентиляционного оборудования :ref:`air_connector_type <air_type>`)
- Диаметра резьбы (в случае резьбового соединения труб :ref:`pipe_thread_size <thread_size>`)

Для определения таких параметров используются следующие атрибуты:

* ``name`` — название параметра
* ``text`` — отображаемое название параметра в окне стиля Renga
* ``type`` — тип данных
* ``enum_type`` — :doc:`идентификатор системных перечислений <../coreenums>`
* ``default`` — значение по-умолчанию

.. code-block::
    :caption: Пример 1. Описание параметра ``connector_type``
    :linenos:

    {
        "name" : "connector_type",
        "text" : "Вид соединения",
        "type" : "enumeration",
        "enum_type" : "air_connector_type",
        "default" : "drive_slip"
    }

Данный параметр отображается в виде раскрывающегося списка (Combobox) для выбора пользователем нужного значения.

.. image:: _static/enum_param.png
    :align: center

Length
""""""

Используется для любого метрического параметра (длина, ширина, диаметр,..) для указания пользовательского значения.

Для задания параметра с типом данных Length используются следующие атрибуты:

* ``name`` — название параметра
* ``text`` — отображаемое название параметра в окне стиля Renga
* ``type`` — тип данных
* ``default`` — значение по-умолчанию
* ``min`` — минимально возможное значение
* ``max`` — максимально возможное значение

.. code-block::
    :caption: Пример 2. Описание параметра ``nominal_diameter``
    :linenos:

    {
        "name" : "nominal_diameter",
        "text" : "Номинальный диаметр",
        "type" : "length",
        "default" : 225,
        "min" : 10,
        "max" : 1000000.0
    }

Данный параметр отображается в виде поля для ввода пользователем нужного значения.

.. image:: _static/length_param.png
    :align: center

Определение категорий систем
----------------------------

Описание параметров настройки точек подключения (портов) также осуществляется в объекте ``style_parameters``. Кроме того в файле ``parameters.lua`` должен быть определен еще один объект ``ports``.
В нём описывается к каким инженерным системам будет подключаться оборудование, т.е. во вкладках каких систем оно будет доступно для подключения.

Количество категорий равно количеству портов. ``system_categories`` представляет собой массив :doc:`идентификаторов систем </coreenums>`, к которым можно будет подключать оборудование в выбранной категории. 

.. code-block::
    :caption: Пример 3. Описание категорий систем, к которым могут быть подключены порты оборудования.
    :linenos:

    {
        ..
        "ports" : {
            "cold_water" : {
                "name" : "Бытовое холодное водоснабжение",
                "system_categories" : [
                    "domestic_cold_water"
                ]
            },
            "hot_water" : {
                "name" : "Бытовое горячее водоснабжение",
                "system_categories" : [
                    "domestic_hot_water"
                 ]
            },
            "sewage" : {
                "name" : "Канализация",
                "system_categories" : [
                    "domestic_sewage",
                    "industrial_sewage"
                ]
            },
            ..
        }
    }
